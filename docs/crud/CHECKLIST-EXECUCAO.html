<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
	<meta charset="utf-8"/>
</head>
<body>

<h1 id="checklistdeexecu√á√Éo-criarcrud">CHECKLIST DE EXECU√á√ÉO - CRIAR CRUD</h1>

<p><strong>USAR TODA VEZ QUE CRIAR UM CRUD</strong></p>

<p>Marque cada item conforme avan√ßa. <strong>S√≥ entregue se todos os ‚ñ° virarem ‚úì</strong></p>

<hr />

<h2 id="pr√â-requisitos">PR√â-REQUISITOS</h2>

<pre><code>‚ñ° GUIA-PRATICO.md aberto e sendo consultado
‚ñ° Nome do recurso definido (ex: Banner, Category, Product)
‚ñ° Tabela j√° existe no banco OU vai ser criada agora
</code></pre>

<hr />

<h2 id="passo-2:coletarrequisitos">PASSO -2: COLETAR REQUISITOS</h2>

<pre><code>‚ñ° Pergunta 1: O que √© este recurso? _________________
‚ñ° Pergunta 2: Quem acessa admin? (Admin geral/Super admin/etc)
‚ñ° Pergunta 3: Quais campos? (listar todos)
‚ñ° Pergunta 4: Comportamentos especiais?
  ‚ñ° Upload de arquivo? (SIM/N√ÉO)
  ‚ñ° Ordena√ß√£o/ranking? (SIM/N√ÉO)
  ‚ñ° Status ativo/inativo? (SIM/N√ÉO)
  ‚ñ° Datas especiais? (SIM/N√ÉO)
  ‚ñ° Relacionamentos? (SIM/N√ÉO)
‚ñ° Pergunta 5: Exibir em frontend? (SIM/N√ÉO)
‚ñ° Pergunta 6: Se SIM, aonde? _________________
‚ñ° Pergunta 7: Se SIM, como? _________________
</code></pre>

<hr />

<h2 id="passo-1:criartabelanobanco">PASSO -1: CRIAR TABELA NO BANCO</h2>

<pre><code>‚ñ° Arquivo SQL criado em /migrations/XXX_create_[recurso]_table.sql
‚ñ° Charset: utf8mb4
‚ñ° Collation: utf8mb4_unicode_ci
‚ñ° PRIMARY KEY: CHAR(36) UUID
‚ñ° √çndices em: ativo, order, created_at (conforme necess√°rio)
‚ñ° Reserved keywords com backticks (`order`, `group`, `key`, etc)
‚ñ° Migration executada: tabela existe no banco
</code></pre>

<hr />

<h2 id="passo0:prepara√á√Éo">PASSO 0: PREPARA√á√ÉO</h2>

<pre><code>‚ñ° Classe verificada: nome √∫nico em /admin/controllers/
‚ñ° Arquivo criado: /admin/controllers/[Recurso]Controller.php
‚ñ° Nome do arquivo = nome da classe exatamente
</code></pre>

<hr />

<h2 id="passo1:escolhertemplate">PASSO 1: ESCOLHER TEMPLATE</h2>

<pre><code>‚ñ° Template ADMIN aberto: /docs/crud/templates/TEMPLATE-CRUD-ADMIN.md
‚ñ° Estrutura base copiada para o controller
</code></pre>

<hr />

<h2 id="passo2:implementarindex">PASSO 2: IMPLEMENTAR index()</h2>

<pre><code>‚ñ° $this-&gt;requireAuth() adicionado
‚ñ° Query com prepared statements
‚ñ° ORDER BY implementado
‚ñ° $this-&gt;render() chamado com dados
</code></pre>

<hr />

<h2 id="passo3:implementarcreate">PASSO 3: IMPLEMENTAR create()</h2>

<pre><code>‚ñ° $this-&gt;requireAuth() adicionado
‚ñ° Dados relacionados buscados (se necess√°rio)
‚ñ° $this-&gt;render() chamado com dados
</code></pre>

<hr />

<h2 id="cr√çtico">PASSO 4: IMPLEMENTAR store()</h2>

<h3 id="1csrfvalidation">[1] CSRF VALIDATION</h3>

<pre><code>‚ñ° $this-&gt;validateCSRF() como PRIMEIRA linha do try
‚ñ° CHECKPOINT CSRF aprovado
</code></pre>

<h3 id="2ratelimiting">[2] RATE LIMITING</h3>

<pre><code>‚ñ° RateLimiter::check('recurso_create', $ip, 5, 60) ANTES de valida√ß√µes
‚ñ° HTTP 429 retornado se bloqueado
‚ñ° RateLimiter::increment() DEPOIS do insert bem-sucedido
‚ñ° CHECKPOINT RATE LIMIT aprovado
</code></pre>

<h3 id="3sanitiza√á√Éo">[3] SANITIZA√á√ÉO</h3>

<pre><code>‚ñ° Todos inputs com Security::sanitize()
‚ñ° Emails com strtolower()
‚ñ° Passwords N√ÉO sanitizados (hash depois)
</code></pre>

<h3 id="4buploaddearquivosehouver">[4B] UPLOAD DE ARQUIVO (se houver)</h3>

<pre><code>‚ñ° Valida√ß√£o de UPLOAD_ERR_OK
‚ñ° Valida√ß√£o de tamanho (5MB)
‚ñ° Valida√ß√£o de MIME type (finfo_file)
‚ñ° Valida√ß√£o de extens√£o
‚ñ° Diret√≥rio criado: /storage/uploads/[recurso]/
‚ñ° Nome gerado: UUID + timestamp + extens√£o
‚ñ° move_uploaded_file() executado
‚ñ° chmod 0644 aplicado
‚ñ° Path RELATIVO salvo no banco
‚ñ° CHECKPOINT UPLOAD aprovado
</code></pre>

<h3 id="4valida√á√ïes">[4] VALIDA√á√ïES</h3>

<pre><code>‚ñ° Campos obrigat√≥rios: empty() checks
‚ñ° Email: Security::validateEmail() + uniqueness
‚ñ° Senha: Security::validatePasswordStrength()
‚ñ° UUID: Security::isValidUUID() + existence
‚ñ° Strings: strlen() min/max
‚ñ° Slug: regex + uniqueness
‚ñ° Arrays: is_array() + filtrados
</code></pre>

<h3 id="5create">[5] CREATE</h3>

<pre><code>‚ñ° $id = Security::generateUUID()
‚ñ° Dados preparados (apenas sanitizados/validados)
‚ñ° $this-&gt;db()-&gt;insert() com prepared statements
‚ñ° SEM concatena√ß√£o de strings em SQL
</code></pre>

<h3 id="6auditlog">[6] AUDIT LOG</h3>

<pre><code>‚ñ° Logger::getInstance()-&gt;audit('CREATE_[RECURSO]', user_id, [...])
‚ñ° Nome: CREATE_[RECURSO] (mai√∫sculas, singular)
‚ñ° Array tem: resource_id, table, contexto
‚ñ° CHECKPOINT LOGGER aprovado
</code></pre>

<h3 id="7incrementratelimit">[7] INCREMENT RATE LIMIT</h3>

<pre><code>‚ñ° RateLimiter::increment('recurso_create', $ip, 60) AP√ìS insert
</code></pre>

<h3 id="8feedbackredirect">[8] FEEDBACK &amp; REDIRECT</h3>

<pre><code>‚ñ° $this-&gt;success() com mensagem
‚ñ° $this-&gt;redirect() para listagem
</code></pre>

<h3 id="9exceptionhandling">[9] EXCEPTION HANDLING</h3>

<pre><code>‚ñ° catch (Exception $e) implementado
‚ñ° Logger::warning('[CREATE]_FAILED') no catch
‚ñ° $this-&gt;error() com mensagem
‚ñ° Redirect de volta para create
</code></pre>

<hr />

<h2 id="passo5:implementaredit">PASSO 5: IMPLEMENTAR edit()</h2>

<pre><code>‚ñ° $this-&gt;requireAuth() adicionado
‚ñ° Security::isValidUUID($id) validado
‚ñ° Registro buscado e verificado se existe
‚ñ° Dados relacionados buscados (se necess√°rio)
‚ñ° $this-&gt;render() chamado com registro
</code></pre>

<hr />

<h2 id="cr√çtico">PASSO 6: IMPLEMENTAR update()</h2>

<pre><code>‚ñ° [1] CSRF validation ‚úì
‚ñ° [2] UUID validation ANTES de queries ‚úì
‚ñ° [3] Rate limiting (10 em 60s) ‚úì
‚ñ° [4] Sanitiza√ß√£o ‚úì
‚ñ° [4B] Upload (se houver): deletar arquivo antigo ‚úì
‚ñ° [5] Valida√ß√µes (email uniqueness EXCLUI pr√≥prio) ‚úì
‚ñ° [6] UPDATE com prepared statements ‚úì
‚ñ° [7] Logger::audit('UPDATE_[RECURSO]') com fields_updated ‚úì
‚ñ° [8] RateLimiter::increment() ‚úì
‚ñ° [9] Feedback + redirect ‚úì
‚ñ° [10] Exception handling ‚úì
</code></pre>

<hr />

<h2 id="cr√çtico">PASSO 7: IMPLEMENTAR destroy()</h2>

<pre><code>‚ñ° [1] CSRF validation ‚úì
‚ñ° [2] UUID validation ‚úì
‚ñ° [3] Rate limiting (5 em 60s) ‚úì
‚ñ° [4] Registro buscado e guardado (para logger) ‚úì
‚ñ° [5] Valida√ß√µes adicionais (n√£o pode deletar X?) ‚úì
‚ñ° [6A] Deletar arquivo f√≠sico (se upload) ‚úì
‚ñ° [6B] DELETE com prepared statements ‚úì
‚ñ° [7] Logger::audit('DELETE_[RECURSO]') com SNAPSHOT ‚úì
‚ñ° [8] RateLimiter::increment() ‚úì
‚ñ° [9] Feedback + redirect ‚úì
‚ñ° [10] Exception handling ‚úì
</code></pre>

<hr />

<h2 id="passo8:criarviews">PASSO 8: CRIAR VIEWS</h2>

<pre><code>‚ñ° Diret√≥rio criado: mkdir -p /admin/views/[recurso]/
‚ñ° Arquivo criado: index.php
‚ñ° Arquivo criado: create.php
‚ñ° Arquivo criado: edit.php
‚ñ° chmod 644 executado em TODOS arquivos
‚ñ° Outputs com htmlspecialchars()
‚ñ° CSRF token nos forms (create.php, edit.php)
</code></pre>

<hr />

<h2 id="bloqueio">GATE PASSO 8: VERIFICA√á√ÉO FINAL</h2>

<p><strong>‚õî N√ÉO PROSSIGA PARA PASSO 9 AT√â COMPLETAR 100%</strong></p>

<h3 id="checkpoint13:seguran√ßacr√≠tica">Checkpoint 1/3: Seguran√ßa Cr√≠tica</h3>

<pre><code>‚ñ° CSRF validation em store/update/destroy?
‚ñ° RateLimiter::check() + increment() em store/update/destroy?
‚ñ° Logger::audit() em store/update/destroy?
‚ñ° Prepared statements em TODAS queries?
‚ñ° Nenhuma concatena√ß√£o de SQL?
‚ñ° Reserved keywords com backticks?
</code></pre>

<h3 id="checkpoint23:valida√ß√µesefeedback">Checkpoint 2/3: Valida√ß√µes e Feedback</h3>

<pre><code>‚ñ° Empty checks para obrigat√≥rios?
‚ñ° Email: formato + uniqueness?
‚ñ° Senha: for√ßa (create) + opcional (update)?
‚ñ° UUID: validation + existence?
‚ñ° Strings: min/max?
‚ñ° Try/catch em todos m√©todos?
‚ñ° Logger::warning() nos catches?
‚ñ° Mensagens de sucesso/erro?
</code></pre>

<h3 id="checkpoint33:estruturaenomenclatura">Checkpoint 3/3: Estrutura e Nomenclatura</h3>

<pre><code>‚ñ° 6 m√©todos implementados?
‚ñ° Heran√ßa: extends BaseController?
‚ñ° Auth em TODOS m√©todos?
‚ñ° Nomes de a√ß√£o: CREATE_*, UPDATE_*, DELETE_* (singular, mai√∫sculas)?
‚ñ° RateLimiter keys consistentes?
</code></pre>

<p><strong>‚ùå SE ALGUM CHECKPOINT FALHOU: VOLTE E CORRIJA</strong></p>

<p><strong>‚úÖ SE TODOS PASSARAM: LIBERADO PARA PASSO 9</strong></p>

<hr />

<h2 id="passo9:adicionarroutes">PASSO 9: ADICIONAR ROUTES</h2>

<pre><code>‚ñ° Arquivo correto: /routes/admin.php
‚ñ° Rota 1: GET /admin/[recurso] ‚Üí index()
‚ñ° Rota 2: GET /admin/[recurso]/create ‚Üí create()
‚ñ° Rota 3: POST /admin/[recurso] ‚Üí store()
‚ñ° Rota 4: GET /admin/[recurso]/:id/edit ‚Üí edit($id)
‚ñ° Rota 5: POST /admin/[recurso]/:id ‚Üí update($id)
‚ñ° Rota 6: POST /admin/[recurso]/:id/delete ‚Üí destroy($id)
‚ñ° Todas com Auth::require()
‚ñ° Par√¢metros $id passados corretamente
</code></pre>

<hr />

<h2 id="passo11:admincrudcompleto">PASSO 11: ADMIN CRUD COMPLETO</h2>

<pre><code>‚ñ° Controller em /admin/controllers/ ‚úì
‚ñ° 6 m√©todos funcionando ‚úì
‚ñ° Views em /admin/views/ ‚úì
‚ñ° Rotas em /routes/admin.php ‚úì
‚ñ° CRUD 100% funcional ‚úì
</code></pre>

<hr />

<h2 id="passo11b:frontenddisplayopcional">PASSO 11B: FRONTEND DISPLAY (OPCIONAL)</h2>

<p><strong>S√≥ preencher se resposta da pergunta 6 foi SIM</strong></p>

<pre><code>‚ñ° Controller criado: /frontend/controllers/Frontend[Recurso]Controller.php
‚ñ° M√©todo index() implementado (read-only)
‚ñ° M√©todo api() implementado (JSON)
‚ñ° View criada: /frontend/views/[recurso]/index.php
‚ñ° chmod 644 na view
‚ñ° Rotas adicionadas em /routes/public.php
‚ñ° Integrado na p√°gina: home.php (ou outra)
‚ñ° Testado: dados aparecem corretamente
</code></pre>

<hr />

<h2 id="bloqueiofinal">PASSO 12: TESTES OBRIGAT√ìRIOS</h2>

<p><strong>‚õî N√ÉO ENTREGUE SEM PASSAR NOS 4 TESTES</strong></p>

<h3 id="üß™teste1:funcionalidadeb√°sica">üß™ TESTE 1: Funcionalidade B√°sica</h3>

<pre><code>‚ñ° GET /admin/[recurso] ‚Üí 200 OK, lista aparece
‚ñ° GET /admin/[recurso]/create ‚Üí 200 OK, form aparece
‚ñ° POST create ‚Üí registro criado no banco
‚ñ° GET /admin/[recurso]/[id]/edit ‚Üí 200 OK, form com dados
‚ñ° POST edit ‚Üí registro atualizado no banco
‚ñ° POST delete ‚Üí registro removido do banco
</code></pre>

<h3 id="üîíteste2:seguran√ßa">üîí TESTE 2: Seguran√ßa</h3>

<pre><code>‚ñ° Remover CSRF token ‚Üí submit bloqueado
‚ñ° 10 submits r√°pidos ‚Üí rate limit bloqueou
‚ñ° SELECT * FROM logs_audit ‚Üí registros CREATE/UPDATE/DELETE existem
‚ñ° SQL injection test ('); DROP TABLE--) ‚Üí bloqueado
</code></pre>

<h3 id="üìÅteste3:permiss√µes">üìÅ TESTE 3: Permiss√µes</h3>

<pre><code>‚ñ° ls -la /admin/views/[recurso]/*.php ‚Üí todos 644
‚ñ° Se n√£o: chmod 644 /admin/views/[recurso]/*.php
‚ñ° Testar no browser: sem erro 500
</code></pre>

<h3 id="üìäteste4:auditoria">üìä TESTE 4: Auditoria</h3>

<pre><code>‚ñ° SELECT * FROM logs_audit WHERE action LIKE 'CREATE_%' ORDER BY created_at DESC LIMIT 5
‚ñ° Logs t√™m: user_id, ip, resource_id, table
‚ñ° Logs de DELETE t√™m snapshot de dados deletados
</code></pre>

<hr />

<h2 id="valida√á√Éoautom√Åticaopcional">VALIDA√á√ÉO AUTOM√ÅTICA (OPCIONAL)</h2>

<pre><code class="bash">‚ñ° php /scripts/validate-crud.php [RecursoController]
‚ñ° Score: 100% (7/7 checks)
</code></pre>

<hr />

<h2 id="entregafinal">ENTREGA FINAL</h2>

<pre><code>‚ñ° TODOS os checkboxes acima est√£o marcados ‚úì
‚ñ° TODOS os testes passaram ‚úì
‚ñ° TODOS os gates foram aprovados ‚úì
‚ñ° CRUD testado no browser ‚úì
‚ñ° C√≥digo commitado ‚úì
</code></pre>

<hr />

<h2 id="üéâpronto">üéâ PRONTO!</h2>

<p><strong>Se TODOS os itens est√£o ‚úì, seu CRUD est√° pronto para produ√ß√£o.</strong></p>

<p><strong>Score final:</strong> _____ / _____ checks (objetivo: 100%)</p>

</body>
</html>

