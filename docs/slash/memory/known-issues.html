<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
	<meta charset="utf-8"/>
</head>
<body>

<h1 id="üêõproblemasconhecidosesolu√ß√µes">üêõ Problemas Conhecidos e Solu√ß√µes</h1>

<blockquote>
<p><strong>Quando usar:</strong> Primeiro passo ao encontrar erro (ERRO-PROTOCOL.md passo 0). Verificar se j√° tem solu√ß√£o pronta antes de reportar.</p>
</blockquote>

<hr />

<h2 id="1.edittoolsemprefalhatabsvsspaces">1. Edit Tool SEMPRE Falha (Tabs vs Spaces)</h2>

<p><strong>Problema:</strong></p>

<ul>
<li>Tool Edit falha com erro &#8220;String not found&#8221;</li>
<li>Causa: diferen√ßas invis√≠veis de indenta√ß√£o (tabs vs spaces)</li>
</ul>

<p><strong>‚ùå N√ÉO FAZER:</strong></p>

<pre><code>- Tentar Edit m√∫ltiplas vezes com strings diferentes
- Usar sed complexo
- Pedir ao usu√°rio para verificar
</code></pre>

<p><strong>‚úÖ SOLU√á√ÉO:</strong></p>

<pre><code>- Usar Write para reescrever arquivo completo
- Ler arquivo com Read primeiro
- Modificar conte√∫do
- Escrever com Write
</code></pre>

<p><strong>Tempo economizado:</strong> 10&#8211;15 min por tentativa</p>

<hr />

<h2 id="2.duplicatasnomenuinsertduplicado">2. Duplicatas no Menu (Insert Duplicado)</h2>

<p><strong>Problema:</strong></p>

<ul>
<li>Ao criar item de menu, cria 2 itens id√™nticos</li>
<li>Usu√°rio clica apenas 1 vez</li>
<li>Lock e JavaScript anti-duplicate j√° existem</li>
</ul>

<p><strong>Causa Raiz:</strong></p>

<ul>
<li>Problema intermitente/browser que resubmete form</li>
</ul>

<p><strong>‚ùå N√ÉO FAZER:</strong></p>

<pre><code>- Pedir debug ao usu√°rio
- Verificar se clicou 2 vezes (ele sempre clica 1 vez)
- Modificar JavaScript ou Lock
</code></pre>

<p><strong>‚úÖ SOLU√á√ÉO:</strong></p>

<pre><code class="php">// MenuController.php linha 119-132
// Verificar ANTES de inserir se j√° existe
$whereCheck = ['label' =&gt; $label, 'type' =&gt; $type];
if ($type === 'page' &amp;&amp; $pageSlug) {
    $whereCheck['page_slug'] = $pageSlug;
}
$existing = $db-&gt;select('menu_items', $whereCheck);
if (!empty($existing)) {
    throw new Exception('Item de menu j√° existe');
}
</code></pre>

<p><strong>Arquivo:</strong> <code>admin/controllers/MenuController.php:119-132</code></p>

<hr />

<h2 id="3.p√°ginasm√≥dulosp√∫blicosn√£oaparecemnomenu">3. P√°ginas/M√≥dulos P√∫blicos N√£o Aparecem no Menu</h2>

<p><strong>Problema:</strong></p>

<ul>
<li>P√°gina/m√≥dulo marcado como <code>is_public = 1</code></li>
<li>Item de menu criado</li>
<li>Menu N√ÉO aparece para usu√°rios n√£o logados</li>
</ul>

<p><strong>Causa Raiz:</strong></p>

<ul>
<li>MenuBuilder verifica <code>permission_type</code> do menu item ANTES de verificar <code>is_public</code> da p√°gina</li>
<li>Se menu item tem <code>permission_type = 'authenticated'</code>, bloqueia antes de checar is_public</li>
</ul>

<p><strong>‚ùå N√ÉO FAZER:</strong></p>

<pre><code>- Pedir SQL para verificar is_public no banco
- Modificar apenas parte do MenuBuilder
- Usar Edit/sed para pequenos fixes
</code></pre>

<p><strong>‚úÖ SOLU√á√ÉO:</strong></p>

<pre><code class="php">// MenuBuilder.php - Verificar is_public PRIMEIRO no loop (linhas 146-168)

// 1. Verificar se p√°gina/m√≥dulo √© P√öBLICO
if ($item['type'] === 'page' &amp;&amp; !empty($item['page_slug'])) {
    if (isset($pagesBySlug[$item['page_slug']])) {
        $page = $pagesBySlug[$item['page_slug']];
        if (isset($page['is_public']) &amp;&amp; $page['is_public'] == 1) {
            $canAccess = true; // ‚úÖ Acesso garantido
        }
    }
}

if (!$canAccess &amp;&amp; $item['type'] === 'module' &amp;&amp; !empty($item['module_name'])) {
    if (isset($pagesByModuleName[$item['module_name']])) {
        $page = $pagesByModuleName[$item['module_name']];
        if (isset($page['is_public']) &amp;&amp; $page['is_public'] == 1) {
            $canAccess = true; // ‚úÖ Acesso garantido
        }
    }
}

// 2. S√ì DEPOIS verificar permission_type do menu
if (!$canAccess) {
    switch ($item['permission_type']) { ... }
}
</code></pre>

<p><strong>Arquivo:</strong> <code>core/MenuBuilder.php:146-197</code></p>

<p><strong>Pr√©-fetch:</strong> Linha 101 deve ser apenas <code>if (!empty($page['module_name']))</code> sem verificar is_virtual</p>

<hr />

<h2 id="4.p√°ginasp√∫blicasredirecionamparalogin">4. P√°ginas P√∫blicas Redirecionam para Login</h2>

<p><strong>Problema:</strong></p>

<ul>
<li>P√°gina com <code>is_public = 1</code> no banco</li>
<li>Ao acessar sem login ‚Üí redireciona para login</li>
</ul>

<p><strong>Causa Raiz:</strong></p>

<ul>
<li>routes.php verifica login ANTES de verificar is_public</li>
</ul>

<p><strong>‚úÖ SOLU√á√ÉO:</strong></p>

<pre><code class="php">// routes.php linha 759-775
// Verificar is_public ANTES de exigir login

$page = $pages[0];

// ‚úÖ VERIFICAR SE P√ÅGINA √â P√öBLICA (is_public = 1)
if (($page['is_public'] ?? 0) == 1) {
    // P√°gina p√∫blica ‚Üí carregar SEM verifica√ß√£o de login
    $member = null;
    require_once $pageFile; // ou dashboard.php
    return;
}

// ‚úÖ P√ÅGINA PRIVADA ‚Üí Verificar login
if (!MemberAuth::check()) {
    Core::redirect('/login');
    return;
}
</code></pre>

<p><strong>Arquivo:</strong> <code>routes.php:759-775</code></p>

<hr />

<h2 id="5.sistemasemmembers-p√°ginasm√≥dulosdevemserp√∫blicosautomaticamente">5. Sistema SEM Members - P√°ginas/M√≥dulos Devem Ser P√∫blicos Automaticamente</h2>

<p><strong>Contexto:</strong></p>

<ul>
<li>Sistema instalado com <code>ENABLE_MEMBERS = false</code></li>
<li>N√£o existe sistema de login de members (usu√°rios do site)</li>
<li>Apenas admins logam (via /admin)</li>
<li>Logo, TODAS as p√°ginas e m√≥dulos p√∫blicos devem ser acess√≠veis</li>
</ul>

<p><strong>Problema ANTES da corre√ß√£o:</strong></p>

<ul>
<li>Ao criar p√°gina/m√≥dulo, campo <code>is_public</code> ficava 0 (privado)</li>
<li>Checkbox &#8220;P√°gina P√∫blica&#8221; N√ÉO aparecia no form (pois membersEnabled = false)</li>
<li>Controller salvava <code>is_public = 0</code> por padr√£o</li>
<li>P√°ginas ficavam INACESS√çVEIS (nem pra p√∫blico, nem pra members - que n√£o existem!)</li>
</ul>

<p><strong>‚úÖ SOLU√á√ÉO:</strong></p>

<pre><code class="php">// PagesController.php - store() e update() (linhas 77-81 e 191-195)

// Se sistema SEM members ‚Üí sempre p√∫blico
// Se sistema COM members ‚Üí respeita checkbox do admin
$isPublic = Core::membersEnabled()
    ? (isset($_POST['is_public']) ? 1 : 0)  // COM members: respeita checkbox
    : 1;  // SEM members: SEMPRE p√∫blico
</code></pre>

<pre><code class="php">// ModulesController.php - index() e togglePublic() (linhas 46-47 e 114-116)

// Default ao listar
$isPublic = Core::membersEnabled() ? 0 : 1;

// Ao salvar configura√ß√£o de m√≥dulo
$isPublic = Core::membersEnabled()
    ? (in_array($moduleName, $publicModules) ? 1 : 0)
    : 1;
</code></pre>

<p><strong>Arquivos modificados:</strong></p>

<ul>
<li><code>admin/controllers/PagesController.php:77-81,191-195</code></li>
<li><code>admin/controllers/ModulesController.php:46-47,114-116</code></li>
</ul>

<p><strong>Comportamento correto:</strong></p>

<ul>
<li>‚úÖ Sistema SEM members ‚Üí <code>is_public = 1</code> sempre (autom√°tico)</li>
<li>‚úÖ Sistema COM members ‚Üí <code>is_public</code> respeitado conforme checkbox do admin</li>
</ul>

<hr />

<h2 id="üìöcomousarestedocumento">üìö Como Usar Este Documento</h2>

<p><strong>Fluxo recomendado (ERRO-PROTOCOL.md passo 0):</strong></p>

<ol>
<li><strong>Erro aconteceu</strong> ‚Üí Ler este documento PRIMEIRO</li>
<li><strong>Encontrou o problema aqui?</strong> ‚Üí Aplicar solu√ß√£o e continuar</li>
<li><strong>N√£o encontrou?</strong> ‚Üí Seguir ERRO-PROTOCOL.md (passos 1&#8211;5)</li>
</ol>

<p><strong>O que N√ÉO fazer:</strong></p>

<ul>
<li>‚ùå Reportar erro sem verificar este documento antes</li>
<li>‚ùå Tentar &#8220;consertar sozinho&#8221; sem verificar known issues</li>
<li>‚ùå Criar novo arquivo de debug</li>
</ul>

<p><strong>O que fazer:</strong></p>

<ul>
<li>‚úÖ Buscar pelo sintoma neste documento (Ctrl+F)</li>
<li>‚úÖ Aplicar solu√ß√£o se encontrar</li>
<li>‚úÖ Reportar se n√£o encontrar (seguindo protocolo)</li>
</ul>

<hr />

<p><strong>Vers√£o:</strong> 2.0.0
<strong>Data:</strong> 2026&#8211;02&#8211;14
<strong>Changelog:</strong> Removidos problemas 6&#8211;12 (j√° corrigidos, hist√≥ricos). Mantidos apenas 5 problemas ativos. Reduzido de 594 ‚Üí 217 linhas.</p>

</body>
</html>

