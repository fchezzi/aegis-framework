function criarPainelDebug(){if(document.getElementById("aegis-debug-panel"))return;const e=document.createElement("div");e.id="aegis-debug-panel",e.style.cssText="\n        position: fixed;\n        top: 10px;\n        right: 10px;\n        width: 450px;\n        max-height: 80vh;\n        overflow-y: auto;\n        background: #1a202c;\n        color: #fff;\n        padding: 20px;\n        border-radius: 12px;\n        box-shadow: 0 8px 24px rgba(0,0,0,0.5);\n        font-family: 'Courier New', monospace;\n        font-size: 13px;\n        z-index: 99999;\n        line-height: 1.6;\n    ";e.innerHTML='\n        <div style="font-weight:bold; margin-bottom:15px; color:#48bb78; font-size: 16px;">üìä Debug Gr√°ficos AEGIS</div>\n        \n        <button onclick="copiarLogs()" style="\n            background: #48bb78;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: bold;\n            margin-bottom: 10px;\n            width: 100%;\n        ">COPIAR TODOS OS LOGS</button>\n    \n        <div id="aegis-debug-log"></div>\n    ',document.body.appendChild(e)}function logDebug(e,o="info"){}function registrarGrafico(e){window.aegisChartsSystem.chartsToInit.includes(e)||window.aegisChartsSystem.chartsToInit.push(e)}function processarGraficosPendentes(){const e=document.querySelectorAll(".chart-card");logDebug("üîç Encontrados "+e.length+" gr√°ficos na p√°gina","info"),e.forEach((function(e,o){logDebug("‚è±Ô∏è Agendando carregamento do gr√°fico: "+e.dataset.chartId,"info"),setTimeout((function(){carregarDadosIniciais(e)}),500+200*o)}))}function carregarDadosIniciais(e){const o=e.dataset.chartId,t=e.dataset.filterGroup;if(logDebug("üîç Carregando dados: "+o,"info"),!t||""===t||"chart-1"===t)return logDebug("üìä Sem grupo de filtro, carregando todos os dados","info"),void atualizarGrafico(e,{});const n=document.querySelector('[data-filter-group="'+t+'"] [data-filter-type="month"]'),a=document.querySelector('[data-filter-group="'+t+'"] [data-filter-type="year"]');let i={};if(n&&a&&n.value&&a.value){const e=n.value,o=a.value;i.date_start=o+"-"+e+"-01";const t=new Date(o,e,0).getDate();i.date_end=o+"-"+e+"-"+String(t).padStart(2,"0"),logDebug("üìÖ Filtros: "+e+"/"+o,"info")}else logDebug("‚ö†Ô∏è Sem filtros de data (grupo: "+t+")","warning");atualizarGrafico(e,i)}function atualizarGrafico(e,o){const t=e.dataset.chartId,n=e.dataset.apiUrl,a=e.dataset.table,i=e.dataset.columns,r=e.dataset.dateField,s=e.dataset.groupBy,d=e.dataset.filterValueField,c=e.dataset.comparePeriod||"no",l=o.select||"",u=o.date_start||"",g=o.date_end||"";logDebug("üìä "+t+" | Tabela: "+a+" | Cols: "+i,"info");let p=n+"?table="+encodeURIComponent(a)+"&columns="+encodeURIComponent(i)+"&date_field="+encodeURIComponent(r)+"&group_by="+encodeURIComponent(s)+"&compare_period="+encodeURIComponent(c);l&&"todos"!==l&&d&&(p+="&value_field="+encodeURIComponent(d)+"&select="+encodeURIComponent(l)),u&&(p+="&date_start="+encodeURIComponent(u)),g&&(p+="&date_end="+encodeURIComponent(g)),logDebug("üåê Buscando API...","info"),fetch(p).then((function(e){return logDebug("‚úÖ Resposta da API recebida","success"),e.json()})).then((function(e){if(e.success){const o=e.categories.length>0&&e.series.length>0&&e.series.some((e=>e.data&&e.data.some((e=>e>0))));logDebug("üì¶ "+t+": "+e.categories.length+" cats, "+e.series.length+" s√©ries"+(o?" ‚úÖ COM DADOS":" ‚ö†Ô∏è SEM DADOS"),o?"success":"warning");const n=window.charts&&window.charts[t];if(n){logDebug("üìä Atualizando com valores: ["+e.series.map((e=>e.data.join(","))).join(" | ")+"]","info"),n.updateOptions({xaxis:{categories:e.categories}}),n.updateSeries(e.series),logDebug("üéâ "+t+" atualizado!","success")}else logDebug("‚ö†Ô∏è "+t+" n√£o existe, retry...","warning"),setTimeout((function(){const o=window.charts&&window.charts[t];o?(o.updateOptions({xaxis:{categories:e.categories}}),o.updateSeries(e.series),logDebug("üéâ "+t+" atualizado no retry!","success")):logDebug("‚ùå "+t+" n√£o encontrado! Gr√°ficos: "+Object.keys(window.charts||{}).join(", "),"error")}),500)}else logDebug("‚ùå Erro API: "+e.error,"error")})).catch((function(e){logDebug("‚ùå Erro requisi√ß√£o: "+e.message,"error")}))}window.copiarLogs=function(){const e=document.getElementById("aegis-debug-log"),o=[];for(let t=e.children.length-1;t>=0;t--)o.push(e.children[t].textContent);const t=o.join("\n");navigator.clipboard.writeText(t).then((function(){alert("‚úÖ Logs copiados! Cole aqui no chat para eu analisar.")})).catch((function(){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("‚úÖ Logs copiados! Cole aqui no chat para eu analisar.")}))},window.aegisChartsSystem=window.aegisChartsSystem||{initialized:!1,chartsToInit:[]},window.aegisChartsSystem.initialized||(window.aegisChartsSystem.initialized=!0,document.addEventListener("aegisFilterApplied",(function(e){const o=e.detail;if(!o.filterGroup||"chart-1"===o.filterGroup)return void logDebug("‚ö†Ô∏è Evento de filtro ignorado (grupo inv√°lido)","warning");const t=document.querySelectorAll('.chart-card[data-filter-group="'+o.filterGroup+'"]');logDebug("üîÑ Filtro aplicado no grupo: "+o.filterGroup+" ("+t.length+" gr√°ficos)","info"),t.forEach((function(e){atualizarGrafico(e,o.filters)}))})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",processarGraficosPendentes):setTimeout(processarGraficosPendentes,100));