const filterCache=new Map,CACHE_DURATION=3e5;function aplicarFiltro(e,t,a,n,l){const s=e.querySelector("tbody").querySelectorAll("tr"),i=e.dataset.dbColumns?e.dataset.dbColumns.split(","):[];showLoading(e),setTimeout((()=>{let r=0;const o=[],d=t.date_start?normalizeDate(t.date_start):null,c=t.date_end?normalizeDate(t.date_end):null;s.forEach(((e,l)=>{let s=!0;const p=e.querySelectorAll("td");if(t.select&&a){const a=e.dataset.filterValue;a&&a!==t.select&&(s=!1)}if(s&&(d||c)&&n){const e=i.indexOf(n);if(e>=0&&p[e]){const t=normalizeDate(p[e].textContent.trim());t&&(d&&t<d&&(s=!1),c&&t>c&&(s=!1))}}o.push(s),e.style.display=s?"":"none",s?r++:0})),l&&filterCache.set(l,{result:o,timestamp:Date.now()}),hideLoading(e),0===r?showEmptyMessage(e):hideEmptyMessage(e)}),10)}function aplicarResultadoCache(e,t){const a=e.querySelector("tbody").querySelectorAll("tr");let n=0;a.forEach(((e,a)=>{const l=t[a];e.style.display=l?"":"none",l&&n++})),0===n?showEmptyMessage(e):hideEmptyMessage(e)}function normalizeDate(e){if(!e)return null;const t=e.trim();if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;if(/^\d{2}[/-]\d{2}[/-]\d{4}$/.test(t)){const e=t.split(/[/-]/);return e[2]+"-"+e[1]+"-"+e[0]}const a=new Date(t);if(!isNaN(a.getTime())){return a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0")}return null}function showLoading(e){let t=e.parentElement.querySelector(".aegis-table-loading");t||(t=document.createElement("div"),t.className="aegis-table-loading",t.innerHTML='<div class="spinner"></div><span>Filtrando...</span>',e.parentElement.style.position="relative",e.parentElement.appendChild(t)),t.style.display="flex"}function hideLoading(e){const t=e.parentElement.querySelector(".aegis-table-loading");t&&(t.style.display="none")}function showEmptyMessage(e){let t=e.parentElement.querySelector(".aegis-table-empty");t||(t=document.createElement("div"),t.className="aegis-table-empty",t.innerHTML="<p>ðŸ“­ Nenhum resultado encontrado para os filtros selecionados</p>",e.parentElement.appendChild(t)),t.style.display="block"}function hideEmptyMessage(e){const t=e.parentElement.querySelector(".aegis-table-empty");t&&(t.style.display="none")}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".aegis-table[data-filter-group]").forEach((e=>{const t=e.id,a=e.dataset.filterGroup,n=(e.dataset.source,e.dataset.filterValueCol),l=e.dataset.filterDateCol,s=a.split(",").map((e=>e.trim())).filter((e=>e.length>0));document.addEventListener("aegisFilterApplied",(function(a){const i=a.detail;if(!s.includes(i.filterGroup))return;const r=t+"_"+JSON.stringify(i.filters),o=filterCache.get(r);o&&Date.now()-o.timestamp<3e5?aplicarResultadoCache(e,o.result):aplicarFiltro(e,i.filters,n,l,r)}))}))}));