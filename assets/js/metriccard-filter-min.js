console.log("âœ… MetricCard Filter Script CARREGADO!"),document.addEventListener("DOMContentLoaded",(function(){console.log("âœ… MetricCard Filter PRONTO para escutar eventos"),document.addEventListener("aegisFilterApplied",(function(e){const a=e.detail,t=a.filterGroup,r=a.filters,o=a.config;console.log("ğŸ¯ MetricCard recebeu filtro:",a),console.log("   - filterGroup:",t),console.log("   - filters:",r),console.log("   - config:",o);const c=document.querySelectorAll(`.metric-card[data-filter-group="${t}"]`);console.log("   - Cards encontrados:",c.length),c.length>0&&console.log("   - Primeiro card:",c[0]),0!==c.length?c.forEach((e=>{console.log("ğŸ”„ Iniciando atualizaÃ§Ã£o do card:",e.id),function(e,a,t){const r=e.dataset.apiUrl,o=e.dataset.table,c=e.dataset.column,n=e.dataset.operation,s=e.dataset.format||"number",l=e.dataset.comparePeriod||"no",d=e.dataset.dateField||"";if(!(r&&o&&c&&n))return void console.error("Card sem configuraÃ§Ã£o completa:",e.dataset);const i=new URL(r,window.location.origin);i.searchParams.append("table",o),i.searchParams.append("column",c),i.searchParams.append("operation",n),i.searchParams.append("format",s),i.searchParams.append("compare_period",l),d&&i.searchParams.append("date_field",d);a.select&&t.value_field&&(i.searchParams.append("value_field",t.value_field),i.searchParams.append("select",a.select));a.date_start&&i.searchParams.append("date_start",a.date_start);a.date_end&&i.searchParams.append("date_end",a.date_end);const p=e.querySelector(".metric-card__title p"),u=e.querySelector(".metric-card__value p");if(!p)return void console.error("Elemento de valor nÃ£o encontrado no card");p.style.opacity="0.5",p.textContent="...",console.log("ğŸ”„ Atualizando card:",i.toString()),fetch(i).then((e=>{if(!e.ok)throw new Error("Erro HTTP: "+e.status);return e.json()})).then((e=>{if(console.log("âœ… Dados recebidos:",e),!e.success)throw new Error(e.error||"Erro desconhecido");if(p.style.opacity="1",p.textContent=e.current_formatted,u&&null!==e.percent_change&&void 0!==e.percent_change){const a=e.percent_change>=0,t=a?"+ ":"- ";u.classList.remove("metric-card__value--positive","metric-card__value--negative"),u.classList.add(a?"metric-card__value--positive":"metric-card__value--negative"),u.textContent=t+Math.abs(Math.round(e.percent_change))+"%"}else u&&(u.textContent="-",u.classList.remove("metric-card__value--positive","metric-card__value--negative"));console.log("âœ… Card atualizado com sucesso!")})).catch((e=>{console.error("âŒ Erro ao atualizar card:",e),p.style.opacity="1",p.textContent="Erro",p.style.color="red"}))}(e,r,o)})):console.warn("âŒ Nenhum MetricCard encontrado para o grupo:",t)})),console.log("âœ… MetricCard Filter inicializado")}));